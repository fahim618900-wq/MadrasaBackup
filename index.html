<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Student Profile & Receipt</title>

<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Hind Siliguri';}

body{
background:#003d3d;
display:flex;
justify-content:center;
padding:10px;
}

.app{
width:100%;
max-width:412px;
background:white;
padding:15px;
border-radius:12px;
}

h2{text-align:center;margin-bottom:10px;}

input{
width:100%;
padding:10px;
border:1px solid #ccc;
border-radius:6px;
margin-bottom:12px;
}

button{
padding:10px;
background:#004d40;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
margin-top:10px;
}

.form{
border:2px solid #004d40;
padding:12px;
border-radius:10px;
}

.row{
margin:6px 0;
font-size:14px;
}

img{
width:120px;
border-radius:8px;
display:block;
margin:auto;
margin-bottom:10px;
}

.title{
text-align:center;
font-weight:bold;
margin-bottom:8px;
}
</style>
</head>

<body>

<div class="app">

<h2>Student Information</h2>

<input id="search" placeholder="Student ID / Name à¦²à¦¿à¦–à§à¦¨">

<div id="result"></div>

</div>

<script>
let db;

/* ---------- LOAD DATABASE ---------- */
(async()=>{

const SQL=await initSqlJs({
locateFile:f=>"https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/"+f
});

let res=await fetch("madrasa.db");
let buf=await res.arrayBuffer();

db=new SQL.Database(new Uint8Array(buf));

})();

/* ---------- SEARCH ---------- */
document.getElementById("search")
.oninput=function(){

let txt=this.value.toLowerCase();

if(!txt)return;

let data=db.exec(
"SELECT * FROM students"
)[0].values;

let student=data.find(r=>
r[0].toLowerCase().includes(txt) ||
r[1].toLowerCase().includes(txt)
);

if(student)showStudent(student);
};

/* ---------- SHOW STUDENT ---------- */
function showStudent(r){

let img="";

if(r[6]){
let blob=new Uint8Array(r[6]);
let base64=btoa(
blob.reduce((d,b)=>d+String.fromCharCode(b),'')
);
img=`<img src="data:image/jpeg;base64,${base64}">`;
}

document.getElementById("result").innerHTML=`

<div id="receiptArea" class="form">

<div class="title">Madrasa Student Profile</div>

${img}

<div class="row"><b>ID:</b> ${r[0]}</div>
<div class="row"><b>Name:</b> ${r[1]}</div>
<div class="row"><b>Father:</b> ${r[2]}</div>
<div class="row"><b>Address:</b> ${r[3]}</div>
<div class="row"><b>Class:</b> ${r[4]}</div>
<div class="row"><b>Mobile:</b> ${r[5]}</div>

</div>

<button onclick="downloadPDF()">ðŸ”¥ Download Receipt PDF</button>
`;
}

/* ---------- PDF DOWNLOAD ---------- */
function downloadPDF(){

let element=document.getElementById("receiptArea");

html2pdf()
.set({
margin:5,
filename:"Student_Profile.pdf",
image:{type:'jpeg',quality:1},
html2canvas:{scale:2},
jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
})
.from(element)
.save();
}
</script>

</body>
</html>
